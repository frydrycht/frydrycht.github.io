<html>

<head>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            function getQueryParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            const investId = getQueryParam("invest-id");
            if (!investId) {
                alert("Brak parametru 'invest-id' w adresie URL.");
                return;
            }

            try {
                const response = await fetch("data.json");
                const rawData = await response.json();

                // Zakładamy, że plik JSON to mapa { [id]: obiekt } lub tablica
                let investment = null;

                if (Array.isArray(rawData)) {
                    console.log("array");
                    investment = rawData.find(item => item.id == investId);
                } else if (typeof rawData === "object") {
                    investment = rawData[investId];
                }

                console.log(investment);

                if (!investment) {
                    alert(`Nie znaleziono inwestycji o id: ${investId}`);
                    return;
                }

                // Pomocnicza funkcja do ukrywania wierszy
                function setOrHide(rowId, cellId, value) {
                    const row = document.getElementById(rowId);
                    const cell = document.getElementById(cellId);
                    if (!value || value === "" || (Array.isArray(value) && value.length === 0)) {
                        if (row) row.style.display = "none";
                    } else {
                        if (cell) cell.textContent = value;
                    }
                }

                // Standardowe pola tekstowe
                setOrHide("investor_row", "investor", investment.investor);
                setOrHide("url_row", "url", investment.url);
                setOrHide("contract_row", "contract", investment.contract);
                setOrHide("env_decision_date_row", "env_decision_date", investment.env_decision_date);
                setOrHide("construction_permit_date_row", "construction_permit_date", investment.construction_permit_date);
                setOrHide("project_row", "project", investment.project);
                setOrHide("construction_start_date_row", "construction_start_date", investment.construction_start_date);
                setOrHide("construction_end_date_row", "construction_end_date", investment.construction_end_date);

                // Pola z tablicami linków
                function fillLinks(rowId, cellId, items) {
                    const row = document.getElementById(rowId);
                    const cell = document.getElementById(cellId);
                    if (!items || items.length === 0) {
                        if (row) row.style.display = "none";
                        return;
                    }
                    cell.innerHTML = ""; // Czyść zawartość
                    items.forEach((item, index) => {
                        const a = document.createElement("a");
                        a.href = item.url;
                        a.textContent = item.text || item.url;
                        a.target = "_blank";
                        cell.appendChild(a);
                        if (index < items.length - 1) {
                            cell.appendChild(document.createElement("br"));
                        }
                    });
                }

                fillLinks("env_decision_row", "env_decision", investment.env_decision);
                fillLinks("construction_permit_row", "construction_permit", investment.construction_permit);

            } catch (error) {
                console.error("Błąd wczytywania danych:", error);
                alert("Wystąpił błąd podczas ładowania danych.");
            }
        });
    </script>
    <style>
        body
        {
            font-family: "fira_sans", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        }
        th
        {
            text-align: left;
        }
    </style>
</head>

<body>
    <table>
        <tr id="investor_row">
            <th>Inwestor</th>
            <td id="investor"></td>
        </tr>
        <tr id="url_row">
            <th>Strona www</th>
            <td id="url"></td>
        </tr>
        <tr id="contract_row">
            <th>Umowa</th>
            <td id="contract"></td>
        </tr>
        <tr id="env_decision_row">
            <th>Decyzja środowiskowa</th>
            <td id="env_decision"></td>
        </tr>
        <tr id="env_decision_date_row">
            <th>Data uzyskania DŚU</th>
            <td id="env_decision_date"></td>
        </tr>
        <tr id="construction_permit_row">
            <th>Pozwolenie na budowę</th>
            <td id="construction_permit"></td>
        </tr>
        <tr id="construction_permit_date_row">
            <th>Data uzyskania PnB</th>
            <td id="construction_permit_date"></td>
        </tr>
        <tr id="project_row">
            <th>Projekt</th>
            <td id="project"></td>
        </tr>
        <tr id="construction_start_date_row">
            <th>Start budowy</th>
            <td id="construction_start_date"></td>
        </tr>
        <tr id="construction_end_date_row">
            <th>Oddanie do użytku</th>
            <td id="construction_end_date"></td>
        </tr>
    </table>

</body>

</html>